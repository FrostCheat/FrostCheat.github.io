<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <title>Canasta de Compras</title>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet">
</head>
<body>
    <div class="container">
        <h1 class="text-center">üõí Canasta de Compras</h1>
        <label for="producto">Seleccionar Producto:</label>
        <select id="producto" class="form-control" onchange="cargarPrecio()"></select>
        <br>
        <label for="cantidad">Cantidad:</label>
        <input type="number" id="cantidad" class="form-control" min="1">
        <label for="precio">Precio Unitario:</label>
        <input type="text" id="precio" class="form-control" readonly>
        <br>
        <button onclick="agregarCanasta()" class="btn btn-primary w-100">Agregar a Canasta</button>
        <br><br>

        <h2 class="text-center">üõçÔ∏è Productos en Canasta</h2>
        <table class="table table-bordered">
            <thead>
                <tr>
                    <th>Producto</th>
                    <th>Cantidad</th>
                    <th>Precio Total</th>
                </tr>
            </thead>
            <tbody id="tabla-canasta"></tbody>
        </table>
        <button onclick="confirmarVenta()" class="btn btn-success w-100">üí∞ Confirmar Venta</button>
        <br><br>
        <a href="index.html" class="btn btn-secondary w-100">üîô Volver al Inventario</a>
    </div>
    <script>
        let canasta = [];

        function cargarProductos() {
            let productos = JSON.parse(localStorage.getItem("productos")) || {};
            let select = document.getElementById("producto");
            select.innerHTML = "";

            for (let nombre in productos) {
                let option = document.createElement("option");
                option.value = nombre;
                option.textContent = nombre;
                select.appendChild(option);
            }

            cargarPrecio();
        }

        function cargarPrecio() {
            let productos = JSON.parse(localStorage.getItem("productos")) || {};
            let seleccionado = document.getElementById("producto").value;
            document.getElementById("precio").value = productos[seleccionado]?.precio || 0;
        }

        function agregarCanasta() {
            let nombre = document.getElementById("producto").value;
            let cantidad = parseInt(document.getElementById("cantidad").value);
            let precio = parseFloat(document.getElementById("precio").value);

            if (isNaN(cantidad) || cantidad <= 0) {
                alert("Ingrese una cantidad v√°lida.");
                return;
            }

            canasta.push({ nombre, cantidad, precio, total: cantidad * precio });
            actualizarCanasta();
        }

        function actualizarCanasta() {
            let tabla = document.getElementById("tabla-canasta");
            tabla.innerHTML = "";

            canasta.forEach((item) => {
                tabla.innerHTML += `
                    <tr>
                        <td>${item.nombre}</td>
                        <td class="text-center">${item.cantidad}</td>
                        <td class="text-center">$${item.total.toFixed(2)}</td>
                    </tr>
                `;
            });
        }

        function confirmarVenta() {
            let ventas = JSON.parse(localStorage.getItem("ventas")) || [];
            let productos = JSON.parse(localStorage.getItem("productos")) || {};

            canasta.forEach((item) => {
                if (productos[item.nombre] && productos[item.nombre].cantidad >= item.cantidad) {
                    productos[item.nombre].cantidad -= item.cantidad;
                    ventas.push({ fecha: new Date().toLocaleString(), ...item });
                }
            });

            localStorage.setItem("productos", JSON.stringify(productos));
            localStorage.setItem("ventas", JSON.stringify(ventas));
            alert("Venta confirmada.");
            window.location.href = "registro.html";
        }

        cargarProductos();
    </script>
</body>
</html>
